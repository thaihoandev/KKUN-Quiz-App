spring:
  jackson:
    time-zone: Asia/Ho_Chi_Minh

  application:
    name: ${SPRING_APPLICATION_NAME:kkun-quiz}

  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 20MB

  security:
    oauth2:
      resource-server:
        jwt:
          issuer-uri: https://accounts.google.com
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:}
            client-secret: ${GOOGLE_CLIENT_SECRET:}
            scope:
              - openid
              - profile
              - email
              - offline_access
        provider:
          google:
            issuer-uri: https://accounts.google.com

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: update   # giữ update thoải mái, không sợ lỗi nữa
    properties:
      hibernate:
        jdbc:
          batch_size: 20
          fetch_size: 50
          time_zone: Asia/Ho_Chi_Minh
        format_sql: true
        # PostgreSQL + Hibernate 6
        globally_quoted_identifiers: true
        globally_quoted_identifiers_skip_column_definitions: true   # QUAN TRỌNG NHẤT
        temp.use_jdbc_metadata_defaults: false
        order_inserts: true
        order_updates: true
        # Enable JDBC type mapping
        types:
          json: org.hibernate.type.json.JsonType
        # PostgreSQL native handling
        generate_statistics: true
        dialect_native_json: true
    show-sql: false
    open-in-view: false

  mail:
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME:}
    password: ${MAIL_APP_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

server:
  port: ${PORT:8080}

logging:
  level:
    org.springframework.security: INFO
    org.hibernate.SQL: DEBUG     # đổi thành DEBUG để thấy rõ SQL (tùy chọn)
    org.hibernate.type.descriptor.sql: TRACE   # xem giá trị bind (rất hữu ích)

jwt:
  public-key-path: ${JWT_PUBLIC_KEY_PATH:classpath:keys/public_key.pem}
  private-key-path: ${JWT_PRIVATE_KEY_PATH:classpath:keys/private_key.pem}
  public-key: ${JWT_PUBLIC_KEY:}
  private-key: ${JWT_PRIVATE_KEY:}

cloudinary:
  cloud-name: ${CLOUDINARY_NAME:}
  api-key: ${CLOUDINARY_API_KEY:}
  api-secret: ${CLOUDINARY_API_SECRET:}

app:
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000}
  supportEmail: no-reply@kkun-quiz.local
  kafka:
    topics:
      chatSend: chat.message.send
      chatCreated: chat.message.created

gemini:
  api:
    key: ${GEMINI_API_KEY:}
    model: ${GEMINI_MODEL:gemini-2.0-flash}
    max-output-tokens: ${GEMINI_MAX_OUTPUT_TOKENS:4096}
    temperature: ${GEMINI_TEMPERATURE:0.1}
    top-p: ${GEMINI_TOP_P:0.8}
    candidate-count: ${GEMINI_CANDIDATE_COUNT:1}
    retry:
      max-attempts: ${GEMINI_RETRY_MAX_ATTEMPTS:4}
      initial-backoff-ms: ${GEMINI_RETRY_INITIAL_MS:400}
      max-backoff-ms: ${GEMINI_RETRY_MAX_MS:4000}
      jitter: ${GEMINI_RETRY_JITTER:true}

limits:
  max-questions: ${MAX_QUESTIONS:10}
  max-topic-chars: ${MAX_TOPIC_CHARS:300}

http:
  connect-timeout-ms: ${HTTP_CONNECT_TIMEOUT_MS:10000}
  read-timeout-ms: ${HTTP_READ_TIMEOUT_MS:100000}
  write-timeout-ms: ${HTTP_WRITE_TIMEOUT_MS:100000}
  max-in-memory-size: ${HTTP_MAX_IN_MEMORY_SIZE:8388608}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always